{"version":3,"sources":["routes/Login/service/index.js","routes/Login/model/index.js","../node_modules/antd/lib/message/style/index.js","../node_modules/antd/lib/message/index.js"],"names":["login","_x","_login","apply","this","arguments","_callee","payload","regenerator_default","a","wrap","_context","prev","next","abrupt","$$","post","stop","notice","normal","__webpack_exports__","namespace","state","loggedIn","message","user","subscriptions","setup","_ref","history","dispatch","listen","_ref2","pathname","indexOf","removeStore","effects","mark","_ref3","_ref4","call","put","_ref5","success","data","msgSocket","sent","setStore","message_default","routerRedux","replace","WebSocket","concat","getStore","userId","onopen","e","console","log","onmessage","onclose","error","type","logout","_","_ref6","_context2","reducers","loginSuccess","_ref7","Object","objectSpread","loginError","_ref8","__webpack_require__","defineProperty","exports","value","React","obj","__esModule","newObj","key","prototype","hasOwnProperty","desc","getOwnPropertyDescriptor","get","set","_interopRequireWildcard","_rcNotification","_interopRequireDefault","_icon","default","defaultTop","messageInstance","getContainer","maxCount","defaultDuration","prefixCls","transitionName","api","open","args","duration","undefined","iconType","info","warning","loading","target","closePromise","Promise","resolve","callback","onClose","newInstance","style","top","instance","getMessageInstance","iconNode","createElement","theme","content","className","icon","result","removeNotice","then","filled","rejected","promise","config","options","destroy","forEach","warn","_default"],"mappings":"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","file":"static/js/7.ced2c153.chunk.js","sourcesContent":["import $$ from 'cmn-utils';\r\n\r\nexport async function login(payload) {\r\n  return $$.post('http://59.67.107.169:8010/api/user/login', payload);\r\n}","import { routerRedux } from 'dva/router';\r\nimport { login } from '../service';\r\nimport { normal } from 'components/Notification';\r\nimport $$ from 'cmn-utils';\r\nimport { message } from 'antd'\r\n\r\nconst notice = normal;\r\n\r\nexport default {\r\n  //表示全局state上的key\r\n  namespace: 'login',\r\n\r\n  //初始值\r\n  state: {\r\n    loggedIn: false,\r\n    message: '',\r\n    user: {},\r\n  },\r\n\r\n  //订阅数据源的subscriptions\r\n  subscriptions: {\r\n    setup({ history, dispatch }) {\r\n      return history.listen(({ pathname }) => {\r\n        if (pathname.indexOf('/sign/login') !== -1) {\r\n          $$.removeStore('user');\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  //处理异步逻辑的effects\r\n  effects: {\r\n    *login({ payload }, { call, put }) {\r\n      const { success, message, data } = yield call(login, payload);\r\n      if (success) {\r\n        $$.setStore('user', data);\r\n        message.success(message);\r\n        //put:发出一个Action，类似于dispatch；call:执行异步函数\r\n        //effect是一个Generate函数；yield标识每一步操作\r\n        yield put(routerRedux.replace('/'));\r\n\r\n        //建立与消息推送服务器的连接\r\n        const WS_HOST = 'ws://localhost:8010'\r\n        let msgSocket = new WebSocket(`${WS_HOST}/ws/${$$.getStore('user').userId}`)\r\n        msgSocket.onopen = function (e) {\r\n            console.log(\"connected\")\r\n        }\r\n        msgSocket.onmessage = data => {\r\n          console.log(`Received message ${data.data}`)\r\n          notice.success(data.data)\r\n        }\r\n        msgSocket.onclose = e => {\r\n\r\n        }\r\n\r\n      } else {\r\n        message.error(message);\r\n        yield put({\r\n          type: 'loginError',\r\n          payload: { message }\r\n        });\r\n      }\r\n    },\r\n    *logout(_, { put }) {\r\n      yield put(routerRedux.replace('/sign/login'));\r\n      $$.removeStore('user');\r\n    }\r\n  },\r\n\r\n  //同步更新state的reducers，接收action\r\n  reducers: {\r\n    loginSuccess(state, { payload }) {\r\n      return {\r\n        ...state,\r\n        loggedIn: true,\r\n        message: '',\r\n        user: payload\r\n      };\r\n    },\r\n    loginError(state, { payload }) {\r\n      return {\r\n        ...state,\r\n        loggedIn: false,\r\n        message: payload.message\r\n      };\r\n    },\r\n  }\r\n};\r\n","\"use strict\";\n\nrequire(\"../../style/index.less\");\n\nrequire(\"./index.less\");","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _rcNotification = _interopRequireDefault(require(\"rc-notification\"));\n\nvar _icon = _interopRequireDefault(require(\"../icon\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};\n\n          if (desc.get || desc.set) {\n            Object.defineProperty(newObj, key, desc);\n          } else {\n            newObj[key] = obj[key];\n          }\n        }\n      }\n    }\n\n    newObj[\"default\"] = obj;\n    return newObj;\n  }\n}\n/* global Promise */\n\n\nvar defaultDuration = 3;\nvar defaultTop;\nvar messageInstance;\nvar key = 1;\nvar prefixCls = 'ant-message';\nvar transitionName = 'move-up';\nvar getContainer;\nvar maxCount;\n\nfunction getMessageInstance(callback) {\n  if (messageInstance) {\n    callback(messageInstance);\n    return;\n  }\n\n  _rcNotification[\"default\"].newInstance({\n    prefixCls: prefixCls,\n    transitionName: transitionName,\n    style: {\n      top: defaultTop\n    },\n    getContainer: getContainer,\n    maxCount: maxCount\n  }, function (instance) {\n    if (messageInstance) {\n      callback(messageInstance);\n      return;\n    }\n\n    messageInstance = instance;\n    callback(instance);\n  });\n}\n\nfunction notice(args) {\n  var duration = args.duration !== undefined ? args.duration : defaultDuration;\n  var iconType = {\n    info: 'info-circle',\n    success: 'check-circle',\n    error: 'close-circle',\n    warning: 'exclamation-circle',\n    loading: 'loading'\n  }[args.type];\n  var target = key++;\n  var closePromise = new Promise(function (resolve) {\n    var callback = function callback() {\n      if (typeof args.onClose === 'function') {\n        args.onClose();\n      }\n\n      return resolve(true);\n    };\n\n    getMessageInstance(function (instance) {\n      var iconNode = React.createElement(_icon[\"default\"], {\n        type: iconType,\n        theme: iconType === 'loading' ? 'outlined' : 'filled'\n      });\n      instance.notice({\n        key: target,\n        duration: duration,\n        style: {},\n        content: React.createElement(\"div\", {\n          className: \"\".concat(prefixCls, \"-custom-content\").concat(args.type ? \" \".concat(prefixCls, \"-\").concat(args.type) : '')\n        }, args.icon ? args.icon : iconType ? iconNode : '', React.createElement(\"span\", null, args.content)),\n        onClose: callback\n      });\n    });\n  });\n\n  var result = function result() {\n    if (messageInstance) {\n      messageInstance.removeNotice(target);\n    }\n  };\n\n  result.then = function (filled, rejected) {\n    return closePromise.then(filled, rejected);\n  };\n\n  result.promise = closePromise;\n  return result;\n}\n\nvar api = {\n  open: notice,\n  config: function config(options) {\n    if (options.top !== undefined) {\n      defaultTop = options.top;\n      messageInstance = null; // delete messageInstance for new defaultTop\n    }\n\n    if (options.duration !== undefined) {\n      defaultDuration = options.duration;\n    }\n\n    if (options.prefixCls !== undefined) {\n      prefixCls = options.prefixCls;\n    }\n\n    if (options.getContainer !== undefined) {\n      getContainer = options.getContainer;\n    }\n\n    if (options.transitionName !== undefined) {\n      transitionName = options.transitionName;\n      messageInstance = null; // delete messageInstance for new transitionName\n    }\n\n    if (options.maxCount !== undefined) {\n      maxCount = options.maxCount;\n      messageInstance = null;\n    }\n  },\n  destroy: function destroy() {\n    if (messageInstance) {\n      messageInstance.destroy();\n      messageInstance = null;\n    }\n  }\n};\n['success', 'info', 'warning', 'error', 'loading'].forEach(function (type) {\n  api[type] = function (content, duration, onClose) {\n    if (typeof duration === 'function') {\n      onClose = duration;\n      duration = undefined;\n    }\n\n    return api.open({\n      content: content,\n      duration: duration,\n      type: type,\n      onClose: onClose\n    });\n  };\n});\napi.warn = api.warning;\nvar _default = api;\nexports[\"default\"] = _default;"],"sourceRoot":""}